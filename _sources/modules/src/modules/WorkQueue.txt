.. default-domain:: chpl

.. module:: WorkQueue

WorkQueue
=========
**Usage**

.. code-block:: chapel

   use WorkQueue;

.. record:: WorkQueue

   .. attribute:: var instance

   .. attribute:: var pid = -1

   .. method:: proc init(type workType)

   .. method:: proc _value

.. class:: WorkQueueNode

   .. attribute:: type workType

   .. attribute:: var work: workType

   .. attribute:: var next: unmanaged WorkQueueNode(workType)

   .. attribute:: var prev: unmanaged WorkQueueNode(workType)

   .. method:: proc init(work: ?workType)

.. class:: WorkQueueImpl

   .. attribute:: type workType

   .. attribute:: var pid = -1

   .. attribute:: var queue = new unmanaged CCQueue(workType)

   .. attribute:: var destBuffer = new Aggregator(workType)

   .. method:: proc init(type workType)

   .. method:: proc init(other, pid)

   .. method:: proc dsiPrivatize(pid)

   .. method:: proc dsiGetPrivatizeData()

   .. method:: proc getPrivatizedInstance()

   .. method:: proc addWork(work: workType, loc: locale)

   .. method:: proc addWork(work: workType, locid = here.id)

   .. method:: proc getWork(): (bool, workType)

   .. method:: proc flush()

   .. method:: proc deinit()

.. class:: CCSynchEnqueueNode

   .. attribute:: type eltType

   .. attribute:: var head: unmanaged QueueNode(eltType)

   .. attribute:: var tail: unmanaged QueueNode(eltType)

   .. attribute:: var wait: atomicbool

   .. attribute:: var completed: bool

   .. attribute:: var next: unmanaged CCSynchEnqueueNode(eltType)

   .. method:: proc init(type eltType, head: unmanaged QueueNode(eltType) = , tail: unmanaged QueueNode(eltType) = )

.. class:: CCSynchDequeueNode

   .. attribute:: type eltType

   .. attribute:: var ret: eltType

   .. attribute:: var found: bool

   .. attribute:: var wait: atomicbool

   .. attribute:: var completed: bool

   .. attribute:: var next: unmanaged CCSynchDequeueNode(eltType)

   .. method:: proc init(type eltType)

.. class:: QueueNode

   .. attribute:: type eltType

   .. attribute:: var elt: eltType

   .. attribute:: var next: unmanaged QueueNode(eltType)

   .. method:: proc init(type eltType)

   .. method:: proc init(elt: ?eltType)

.. class:: CCQueue

   .. attribute:: type eltType

   .. attribute:: var maxRequests = 1024

   .. attribute:: var head: unmanaged QueueNode(eltType)

   .. attribute:: var dequeueWaitList: LocalAtomicObject(unmanaged CCSynchDequeueNode(eltType))

   .. attribute:: var tail: unmanaged QueueNode(eltType)

   .. attribute:: var enqueueWaitList: LocalAtomicObject(unmanaged CCSynchEnqueueNode(eltType))

   .. method:: proc init(type eltType)

   .. method:: proc bulkEnqueue(arr: [?dom] eltType)

   .. method:: proc enqueue(elt: eltType)

   .. method:: proc doEnqueue(head: unmanaged QueueNode(eltType), tail = head)

   .. method:: proc dequeue(): (bool, eltType)

   .. method:: proc doDequeue(): (bool, eltType)

   .. method:: proc deinit()

.. function:: proc main()

